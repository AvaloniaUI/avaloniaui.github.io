<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Defining Properties | Perspex Website</title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Defining Properties | Perspex Website">
    <meta name="generator" content="docfx 1.4.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content">
        
        <div class="sidenav">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
              <a href="https://github.com/Perspex/Perspex/blob/master/docs/spec/defining-properties.md/#L1" class="btn btn-primary pull-right mobile-hide">Improve this Doc</a>
              <h1 id="defining-properties">Defining Properties</h1>
              
<p>If you are creating a control, you will want to define properties on your
control. The process in Perspex is broadly similar to other XAML languages
with a few differences - the main one being that Perpsex&#39;s equivalent of
<code>DependencyProperty</code> is called <code>StyledProperty</code>.</p>
<h2 id="registering-styled-properties">Registering Styled Properties</h2>
<p>A styled property is analogous to a <code>DependencyProperty</code> in other XAML
frameworks.</p>
<p>You register a styled property by calling <code>PerspexProperty.Register</code> and
storing the result in a <code>static readonly</code> field. You then create a standard C#
property to access it.</p>
<p>Here&#39;s how the <code>Border</code> control defines its <code>Background</code> property:</p>
<pre><code class="lang-c#">    public static readonly StyledProperty&lt;Brush&gt; BackgroundProperty =
        PerspexProperty.Register&lt;Border, Brush&gt;(nameof(Background));

    public Brush Background
    {
        get { return GetValue(BackgroundProperty); }
        set { SetValue(BackgroundProperty, value); }
    }
</code></pre>
<p>The <code>PerspexProperty.Register</code> method also accepts a number of other parameters:</p>
<ul>
<li><code>defaultValue</code>: This gives the property a default value. Be sure to only pass
value types and immutable types here as passing a reference type will cause the
same object to be used on all instances on which the property is registered.</li>
<li><code>inherits</code>: Specified that the property&#39;s default value should come from
the parent control.</li>
<li><code>defaultBindingMode</code>: The default binding mode for the property. Can be set to
<code>OneWay</code>, <code>TwoWay</code>, <code>OneTime</code> or <code>OneWayToSource</code>.</li>
<li><code>validate</code>: A validation/coercion function of type
<code>Func&lt;TOwner, TValue, TValue&gt;</code>. The function accepts the instance of the class
on which the property is being set and the value and returns the coerced value
or throws an exception for an invalid value.</li>
</ul>
<h2 id="using-a-styledproperty-from-another-class">Using a StyledProperty from Another Class</h2>
<p>Sometimes the property you want to add to your control already exists on another
control, <code>Background</code> being a good example. To register a property defined on
another control, you call <code>StyledProperty.AddOwner</code>:</p>
<pre><code class="lang-c#">    public static readonly StyledProperty&lt;Brush&gt; BackgroundProperty =
        Border.BackgroundProperty.AddOwner&lt;Panel&gt;();

    public Brush Background
    {
        get { return GetValue(BackgroundProperty); }
        set { SetValue(BackgroundProperty, value); }
    }
</code></pre>
<p><em>Note: Unlike WPF, a property must be registered on a class otherwise it cannot
be set on an object of that class.</em></p>
<h2 id="attached-properties">Attached Properties</h2>
<p>Attached properties are defined almost identically to styled properties except
that they are registered using the <code>RegisterAttached</code> method and their accessors
are defined as static methods.</p>
<p>Here&#39;s how <code>Grid</code> defines its <code>Grid.Column</code> attached property:</p>
<pre><code class="lang-c#">    public static readonly AttachedProperty&lt;int&gt; ColumnProperty =
        PerspexProperty.RegisterAttached&lt;Grid, Control, int&gt;(&quot;Column&quot;);

    public static int GetColumn(Control element)
    {
        return element.GetValue(ColumnProperty);
    }

    public static void SetColumn(Control element, int value)
    {
        element.SetValue(ColumnProperty, value);
    }
</code></pre>
<h2 id="readonly-perspexproperties">Readonly PerspexProperties</h2>
<p>To create a readonly property you use the <code>PerspexProperty.RegisterDirect</code>
method. Here is how <code>Visual</code> registers the readonly <code>Bounds</code> property:</p>
<pre><code class="lang-c#">    public static readonly DirectProperty&lt;Visual, Rect&gt; BoundsProperty =
        PerspexProperty.RegisterDirect&lt;Visual, Rect&gt;(
            nameof(Bounds),
            o =&gt; o.Bounds);

    private Rect _bounds;

    public Rect Bounds
    {
        get { return _bounds; }
        private set { SetAndRaise(BoundsProperty, ref _bounds, value); }
    }
</code></pre>
<p>As can be seen, readonly properties are stored as a field on the object. When
registering the property, a getter is passed which is used to access the
property value through <code>GetValue</code> and then <code>SetAndRaise</code> is used to notify
listeners to changes to the property.</p>
<h2 id="direct-perspexproperties">Direct PerspexProperties</h2>
<p>As its name suggests, <code>RegisterDirect</code> isn&#39;t just used for registering readonly
properties. You can also pass a <em>setter</em> to <code>RegisterDirect</code> to expose a
standard C# property as a Perspex property.</p>
<p>A <code>StyledProperty</code> which is registered using <code>PerspexProperty.Register</code>
maintains a prioritized list of values and bindings that allow styles to work.
However, this is overkill for many properties, such as <code>ItemsControl.Items</code> -
this will never be styled and the overhead involved with styled properties is
unnecessary.</p>
<p>Here is how <code>ItemsControl.Items</code> is registered:</p>
<pre><code class="lang-c#">    public static readonly DirectProperty&lt;ItemsControl, IEnumerable&gt; ItemsProperty =
        PerspexProperty.RegisterDirect&lt;ItemsControl, IEnumerable&gt;(
            nameof(Items),
            o =&gt; o.Items,
            (o, v) =&gt; o.Items = v);

    private IEnumerable _items = new PerspexList&lt;object&gt;();

    public IEnumerable Items
    {
        get { return _items; }
        set { SetAndRaise(ItemsProperty, ref _items, value); }
    }
</code></pre>
<p>Direct properties are a lightweight version of styled properties that support
the following:</p>
<ul>
<li>PerspexObject.GetValue</li>
<li>PerspexObject.SetValue for non-readonly properties</li>
<li>PropertyChanged</li>
<li>Binding (only with LocalValue priority)</li>
<li>GetObservable</li>
<li>AddOwner</li>
<li>Metadata</li>
</ul>
<p>They don&#39;t support the following:</p>
<ul>
<li>Validation/Coercion (although this could be done in the property setter)</li>
<li>Overriding default values.</li>
<li>Inherited values</li>
</ul>
<h2 id="when-to-use-a-direct-vs-a-styled-property">When to use a Direct vs a Styled Property</h2>
<p>Direct properties have advantages and disadvantages:</p>
<p>Pros:</p>
<ul>
<li>No additional object is allocated per-instance for the property</li>
<li>Property getter is a standard C# property getter</li>
<li>Property setter is is a standard C# property setter that raises an event.</li>
</ul>
<p>Cons:</p>
<ul>
<li>Cannot inherit value from parent control</li>
<li>Cannot take advantage of Perspex&#39;s styling system</li>
<li>Property value is a field and as such is allocated whether the property is
set on the object or not</li>
</ul>
<p>So use direct properties when you have the following requirements:</p>
<ul>
<li>Property will not need to be styled</li>
<li>Property will usually or always have a value</li>
</ul>

            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
            <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
            </nav>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Copyright © 2015-2016 Microsoft<br>Generated by <strong>docfx</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>